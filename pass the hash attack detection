title: Pass-the-Hash Attack Detection (NTLM Hash Replay)

description:
  Detects Pass-the-Hash attacks by identifying NTLM authentication logons 
  without a cleartext password, typically generated by tools such as Impacket, 
  CrackMapExec, Mimikatz sekurlsa::pth, and other NTLM hash replay techniques.

references:
  - https://attack.mitre.org/techniques/T1550/002/
  - https://learn.microsoft.com/windows/security/threat-protection/auditing/event-4624
  - https://attack.mitre.org/techniques/T1550/

date: 2025/01/01

tags:
  - attack.credential_access
  - attack.lateral_movement
  - attack.t1550.002
  - pth
  - windows

logsource:
  product: windows
  service: security
  

detection:

  # Pass-the-Hash core indicator: NTLM used WITHOUT password
  ntlm_pth:
    EventID: 4624
    AuthenticationPackageName: "NTLM"
    LogonType:
      - 3     # Network logon (Impacket, CME, Cobalt Strike, PSEXEC)
      - 10    # RDP with NTLM
    # if no password was supplied â†’ this field shows "*"
    KeyLength: 0
    # When hashes are used, this field contains "NTLM" but NOT Kerberos
    LogonProcessName:
      - "NtLmSsp"
      - "seclogo"

  # Logon using explicit credentials (hash-only authentication)
  explicit_ntlm:
    EventID: 4648
    AuthenticationPackageName: "NTLM"

  condition: ntlm_pth OR explicit_ntlm

falsepositives:
  - Legitimate NTLM network authentication in legacy environments
  - Systems without Kerberos (workgroups)
level: high
